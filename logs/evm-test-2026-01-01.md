# EVM Contract Test Results - 2026-01-01

## Summary

| Contract | Build | Test | Status |
|----------|-------|------|--------|
| TextDAO_Members | ✅ | ✅ | getMemberCount() works |
| TextDAO_Propose | ✅ | ✅ | getProposalCount() works |
| TextDAO_Vote | ✅ | ❌ | KECCAK256 not implemented |
| TextDAO_Tally | ✅ | ❌ | KECCAK256 not implemented |

## Detailed Results

### TextDAO_Members

```
Bytecode: 4338 chars (runtime)
Test: getMemberCount() [0x997072f7]
Result: SUCCESS
Return data: 0x0000000000000000000000000000000000000000000000000000000000000000
```

### TextDAO_Propose

```
Bytecode: 2938 chars (runtime)
Test: getProposalCount() [0x50d1f5c6]
Result: SUCCESS
Return data: 0x0000000000000000000000000000000000000000000000000000000000000000
```

### TextDAO_Vote

```
Bytecode: 4462 chars (runtime)
Test: getVote(0, 0) [0x9e7b8d61]
Result: STACK ERROR - Invalid jump destination
Root Cause: KECCAK256 opcode (0x20) not implemented in idris2-evm
```

### TextDAO_Tally

```
Bytecode: 4514 chars (runtime)
Test: getApprovedHeader(0) [0x7a1e7ab3]
Result: STACK ERROR - Invalid jump destination
Root Cause: KECCAK256 opcode (0x20) not implemented in idris2-evm
```

## Blocking Issues

### P0: KECCAK256 Opcode Not Implemented

The Vote and Tally contracts use `keccak256` for computing storage slots
(mapping keys). This opcode is defined in `EVM.Opcodes` but not implemented
in `EVM.Interpreter` or `EVM.MultiInterpreter`.

**Impact**: Any contract using Solidity-style mappings will fail.

**Required Implementation**:
```idris
-- In EVM/Interpreter.idr, add:
KECCAK256 => do
  -- Pop offset and size from stack
  (Just offset, st1) <- pop vm.stack | ...
  (Just size, st2) <- pop st1 | ...
  -- Read memory region
  let bytes = readRange (toNat offset) (toNat size) vm.memory
  -- Compute keccak256 hash
  let hash = keccak256Hash bytes
  -- Push result to stack
  ...
```

## Next Steps

1. **Implement KECCAK256** in idris2-evm interpreter
2. Re-test Vote and Tally contracts
3. Test sequential operations (addMember → getMemberCount)
4. Investigate Praddictfun contracts

## Praddictfun Status

Source files found in `/Users/bob/code/idris2-praddictfun/src/`:
- PraddictFun/Functions/PPM/Core.idr
- PraddictFun/Functions/PPM/Position.idr
- PraddictFun/Functions/PPM/Funding.idr
- PraddictFun/Functions/IdeoCoin/Core.idr
- PraddictFun/Functions/IdeoCoin/Staking.idr
- etc.

**Note**: These are Idris2 source files but not in idris2-yul format.
Need to verify if they can be compiled to EVM bytecode.

## Environment

- idris2-evm: Multi-contract support with CALL/DELEGATECALL/STATICCALL
- idris2-yul: EVM bytecode generation working
- Test method: CLI with --contract and --call options
